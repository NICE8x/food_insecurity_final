---
title: "Map the Meal Gap Data"
author: "Tessa Senders"
date: "11/13/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r import libraries}
library(tidyverse)
library(readxl)
```

Import Map the Meal Gap Data

```{r import map the meal data}
path_1_df = 
tibble(
path = list.files("food_insecurity_county1_data"))

path_1_df = path_1_df %>%
  mutate(
    path = str_c("food_insecurity_county1_data/", path),
    data = map(.x = path, ~read_excel(.x))
)

path_2_df = 
tibble(
path = list.files("food_insecurity_county2_data"))

path_2_df = path_2_df %>%
  mutate(
    path = str_c("food_insecurity_county2_data/", path),
    data = map(.x = path, ~read_excel(.x, sheet = 2))
)

path_df = bind_rows(path_1_df, path_2_df)


path_df[[2]][[1]]$FIPS = as.numeric(path_df[[2]][[1]]$FIPS)
path_df[[2]][[2]]$`% FI Btwn Thresholds` = as.numeric(path_df[[2]][[2]]$`% FI Btwn Thresholds`)
path_df[[2]][[1]]$`Cost Per Meal` = as.numeric(path_df[[2]][[1]]$`Cost Per Meal`)


path_df = path_df %>%
  unnest(data) %>%
  janitor::clean_names() 

path_df = path_df %>%
  mutate(state = coalesce(state_name, state),
         county_code = tolower(county_code),
         county_state = tolower(county_state),
         county_state = str_replace(county_state, ",.*", ""),
         county_state = str_replace(county_state, "county",""),
         county_state = str_replace(county_state, "parish",""),
         county_state = str_replace(county_state, "borough", ""),
         county_state = str_replace(county_state, "census area", ""),
         county = coalesce(county_code, county_state),
         fi_rate = coalesce(fi_rate, x2010_food_insecurity_rate, x2011_food_insecurity_rate, x2012_food_insecurity_rate, x2013_food_insecurity_rate, x2014_food_insecurity_rate, x2015_food_insecurity_rate, x2016_food_insecurity_rate, x2017_food_insecurity_rate),
         number_food_insecure_individuals = coalesce(number_food_insecure_individuals, number_of_food_insecure_persons_in_2010, number_of_food_insecure_persons_in_2011, number_of_food_insecure_persons_in_2012, number_of_food_insecure_persons_in_2013, number_of_food_insecure_persons_in_2014, number_of_food_insecure_persons_in_2015, number_of_food_insecure_persons_in_2016, number_of_food_insecure_persons_in_2017),
         
         ) %>%
  select(-state_name, -county_code, -county_state) 

         
  


```


```{r additional}

  pivot_longer(
    week_1:week_8,
    names_to = "week",
    values_to = "observation"
  ) %>%
  mutate(
    week = as.numeric(str_replace(week, "week_", "")),
    arm = str_extract(path, "/[a-z][a-z][a-z]"),
    arm = str_remove(arm, "/"),
    id = str_extract(path, "[0-9]+")
  ) %>%
  select(-path)

```

```{r one dataset}
read_excel('food_insecurity_data/MMG2011_2009Data_ToShare.xlsx')
```




